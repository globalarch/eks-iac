Using password from keyring for pyakul@snaplogic.com
Detected single role: arn:aws:iam::694702677705:role/ReadOnly
Saving arn:aws:iam::694702677705:role/ReadOnly as snaplogic
Written profile snaplogic to /Users/taa/.aws/credentials
===========================================================
Installing and configuring MongoDB onto instances...
===========================================================
[WARNING]: Invalid characters were found in group names but not replaced, use
-vvvv to see details

PLAY [all] *********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_0]
ok: [ap-southeast-1_3]
ok: [us-west-2_0]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Add Apt Key] *************************************************************
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_0]
ok: [ap-southeast-1_2]
ok: [us-west-2_0]
ok: [us-west-2_1]
ok: [us-west-2_3]
ok: [us-west-2_2]

TASK [Add Apt Repo] ************************************************************
ok: [ap-southeast-1_0]
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
ok: [us-west-2_0]
ok: [us-west-2_1]
ok: [us-west-2_2]
ok: [us-west-2_3]

TASK [Install MongoDB] *********************************************************
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_0]
ok: [us-west-2_0]
ok: [us-west-2_3]
ok: [us-west-2_1]
ok: [us-west-2_2]

TASK [Stop MongoDB] ************************************************************
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_0]
ok: [us-west-2_0]
ok: [us-west-2_2]
ok: [us-west-2_1]
changed: [us-west-2_3]

TASK [Change mongodata permission] *********************************************
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_0]
ok: [us-west-2_0]
ok: [us-west-2_2]
ok: [us-west-2_3]
ok: [us-west-2_1]

TASK [Read setting yaml] *******************************************************
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_0]
ok: [us-west-2_0]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Extract data from config] ************************************************
ok: [ap-southeast-1_0]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_3]
ok: [us-west-2_0]
ok: [us-west-2_1]
ok: [us-west-2_2]
ok: [us-west-2_3]

TASK [Edit config] *************************************************************
ok: [ap-southeast-1_0]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_3]
ok: [us-west-2_0]
ok: [us-west-2_1]
ok: [us-west-2_2]
ok: [us-west-2_3]

TASK [Write config] ************************************************************
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_0]
ok: [us-west-2_0]
ok: [us-west-2_2]
ok: [us-west-2_3]
ok: [us-west-2_1]

PLAY [config-server] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [ap-southeast-1_0]
ok: [us-west-2_0]

TASK [Ensure MongoDB stopped] **************************************************
ok: [ap-southeast-1_0]
ok: [us-west-2_0]

TASK [Read setting yaml] *******************************************************
ok: [ap-southeast-1_0]
ok: [us-west-2_0]

TASK [Extract data from config] ************************************************
ok: [ap-southeast-1_0]
ok: [us-west-2_0]

TASK [Edit config] *************************************************************
ok: [ap-southeast-1_0]
ok: [us-west-2_0]

TASK [Write config] ************************************************************
ok: [ap-southeast-1_0]
ok: [us-west-2_0]

TASK [Ensure MongoDB started] **************************************************
changed: [ap-southeast-1_0]
changed: [us-west-2_0]

PLAY [shard] *******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_1]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Ensure MongoDB stopped] **************************************************
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_2]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Read setting yaml] *******************************************************
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_2]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Extract data from config] ************************************************
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_3]
ok: [us-west-2_1]
ok: [us-west-2_2]
ok: [us-west-2_3]

TASK [Edit config (main at us-west-2)] *****************************************
skipping: [ap-southeast-1_1]
skipping: [ap-southeast-1_2]
ok: [ap-southeast-1_3]
ok: [us-west-2_1]
ok: [us-west-2_2]
skipping: [us-west-2_3]

TASK [ansible.builtin.set_fact] ************************************************
skipping: [ap-southeast-1_1]
skipping: [ap-southeast-1_2]
ok: [ap-southeast-1_3]
ok: [us-west-2_1]
ok: [us-west-2_2]
skipping: [us-west-2_3]

TASK [Edit config (main at ap-southeast-1)] ************************************
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
skipping: [ap-southeast-1_3]
skipping: [us-west-2_1]
skipping: [us-west-2_2]
ok: [us-west-2_3]

TASK [ansible.builtin.set_fact] ************************************************
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
skipping: [ap-southeast-1_3]
skipping: [us-west-2_1]
skipping: [us-west-2_2]
ok: [us-west-2_3]

TASK [Write config] ************************************************************
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_1]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Ensure MongoDB started] **************************************************
changed: [ap-southeast-1_3]
changed: [ap-southeast-1_2]
changed: [ap-southeast-1_1]
changed: [us-west-2_2]
changed: [us-west-2_1]
changed: [us-west-2_3]

PLAY [config-server[0]] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [ap-southeast-1_0]

TASK [Install pymongo] *********************************************************
ok: [ap-southeast-1_0]

TASK [Ensure replicaset] *******************************************************
ok: [ap-southeast-1_0]

PLAY [us-west-2[1]] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [us-west-2_1]

TASK [Install pymongo] *********************************************************
ok: [us-west-2_1]

TASK [Ensure replicaset] *******************************************************
ok: [us-west-2_1]

PLAY [ap-southeast-1[1]] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [ap-southeast-1_1]

TASK [Install pymongo] *********************************************************
ok: [ap-southeast-1_1]

TASK [Ensure replicaset] *******************************************************
ok: [ap-southeast-1_1]

PLAY [shard] *******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Create mongos configuration file] ****************************************
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_1]
ok: [ap-southeast-1_2]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Create systemd service file] *********************************************
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_1]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Reload systemd] **********************************************************
ok: [ap-southeast-1_2]
ok: [ap-southeast-1_3]
ok: [ap-southeast-1_1]
ok: [us-west-2_2]
ok: [us-west-2_1]
ok: [us-west-2_3]

TASK [Ensure start mongos] *****************************************************
changed: [ap-southeast-1_3]
changed: [ap-southeast-1_2]
changed: [ap-southeast-1_1]
changed: [us-west-2_2]
changed: [us-west-2_1]
changed: [us-west-2_3]

PLAY [us-west-2[1]] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [us-west-2_1]

TASK [Install pymongo] *********************************************************
ok: [us-west-2_1]

TASK [Ensure sharding] *********************************************************
ok: [us-west-2_1]

PLAY [ap-southeast-1[1]] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [ap-southeast-1_1]

TASK [Install pymongo] *********************************************************
ok: [ap-southeast-1_1]

TASK [Ensure sharding] *********************************************************
ok: [ap-southeast-1_1]

PLAY RECAP *********************************************************************
ap-southeast-1_0           : ok=20   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
ap-southeast-1_1           : ok=29   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
ap-southeast-1_2           : ok=23   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
ap-southeast-1_3           : ok=23   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
us-west-2_0                : ok=17   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
us-west-2_1                : ok=29   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
us-west-2_2                : ok=23   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
us-west-2_3                : ok=23   changed=3    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   

Finished
Cloning configuration scripts...
=============================HI====THERE================
=====I===AM=========USING===============================
========================LOCAL===========================
==================K8S-POC======REPO=====================
total 0
drwxr-xr-x@ 6 taa  staff  192 Apr 24 20:59 k8s-poc
===========================================================
[EKS] Deploying us-west-2 cluster
===========================================================
Updated context arn:aws:eks:us-west-2:343344284471:cluster/global-arch-tf in /Users/taa/.kube/config
TAG=4.global_arch_prod-11995
\n----- Prerequisites check: tools -----
aws ... OK
istioctl ... OK
helm ... OK
gimme-aws-creds ... OK
\n----- Prerequisites check: environment variables -----
SNAPS_AWS_ACCESS_KEY_ID ... OK
SNAPS_AWS_SECRET_KEY ... OK
SNAPS_AWS_REGION ... OK
AWS_PROFILE_NAME ... OK
\n----- Prerequisites check complete. -----
Using password from keyring for pyakul@snaplogic.com
Detected single role: arn:aws:iam::694702677705:role/ReadOnly
Saving arn:aws:iam::694702677705:role/ReadOnly as snaplogic
Written profile snaplogic to /Users/taa/.aws/credentials
==============================
A. Setup Minikube Cluster
==============================
templates/sldb.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/slserver.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/slsched.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/ccproxy.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/jcc.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/feedmaster.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/sltest.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/destination-rule-all.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/virtual-service-frontend.yaml version/tag changed to use 4.global_arch_prod-11995.
==============================
B. Install Istio service mesh
==============================
Error from server (AlreadyExists): namespaces "istio-system" already exists
namespace/default labeled
"istio" already exists with the same configuration, skipping
NAME: istio-base
LAST DEPLOYED: Sun Apr 24 21:00:13 2022
NAMESPACE: istio-system
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
Istio base successfully installed!

To learn more about the release, try:
  $ helm status istio-base
  $ helm get all istio-base
W0424 21:00:34.475547   53285 warnings.go:70] policy/v1beta1 PodDisruptionBudget is deprecated in v1.21+, unavailable in v1.25+; use policy/v1 PodDisruptionBudget
W0424 21:00:51.454864   53285 warnings.go:70] policy/v1beta1 PodDisruptionBudget is deprecated in v1.21+, unavailable in v1.25+; use policy/v1 PodDisruptionBudget
NAME: istiod
LAST DEPLOYED: Sun Apr 24 21:00:32 2022
NAMESPACE: istio-system
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
"istiod" successfully installed!

To learn more about the release, try:
  $ helm status istiod
  $ helm get all istiod

Next steps:
  * Deploy a Gateway: https://istio.io/latest/docs/setup/additional-setup/gateway/
  * Try out our tasks to get started on common configurations:
    * https://istio.io/latest/docs/tasks/traffic-management
    * https://istio.io/latest/docs/tasks/security/
    * https://istio.io/latest/docs/tasks/policy-enforcement/
    * https://istio.io/latest/docs/tasks/policy-enforcement/
  * Review the list of actively supported releases, CVE publications and our hardening guide:
    * https://istio.io/latest/docs/releases/supported-releases/
    * https://istio.io/latest/news/security/
    * https://istio.io/latest/docs/ops/best-practices/security/

For further documentation see https://istio.io website

Tell us how your install/upgrade experience went at https://forms.gle/pzWZpAvMVBecaQ9h9
NAME: istio-ingressgateway
LAST DEPLOYED: Sun Apr 24 21:01:04 2022
NAMESPACE: istio-system
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
"istio-ingressgateway" successfully installed!

To learn more about the release, try:
  $ helm status istio-ingressgateway
  $ helm get all istio-ingressgateway

Next steps:
  * Deploy an HTTP Gateway: https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control/
  * Deploy an HTTPS Gateway: https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress/
NAME: routing-chart
LAST DEPLOYED: Sun Apr 24 21:01:17 2022
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
./eks_main_setup_script.sh: line 175: jq: command not found
EPOD_URL is empty, exiting.....
===========================================================
[EKS] Deploying ap-southeast-1 follow-up cluster
===========================================================
Updated context arn:aws:eks:ap-southeast-1:343344284471:cluster/global-arch-tf in /Users/taa/.kube/config
TAG=4.global_arch_prod-11995
\n----- Prerequisites check: tools -----
aws ... OK
istioctl ... OK
helm ... OK
gimme-aws-creds ... OK
\n----- Prerequisites check: environment variables -----
SNAPS_AWS_ACCESS_KEY_ID ... OK
SNAPS_AWS_SECRET_KEY ... OK
SNAPS_AWS_REGION ... OK
AWS_PROFILE_NAME ... OK
\n----- Prerequisites check complete. -----
Using password from keyring for pyakul@snaplogic.com
Detected single role: arn:aws:iam::694702677705:role/ReadOnly
Saving arn:aws:iam::694702677705:role/ReadOnly as snaplogic
Written profile snaplogic to /Users/taa/.aws/credentials
==============================
A. Setup Minikube Cluster
==============================
templates/sldb.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/slserver.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/slsched.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/ccproxy.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/jcc.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/feedmaster.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/sltest.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/destination-rule-all.yaml version/tag changed to use 4.global_arch_prod-11995.
templates/virtual-service-frontend.yaml version/tag changed to use 4.global_arch_prod-11995.
==============================
B. Install Istio service mesh
==============================
Error from server (AlreadyExists): namespaces "istio-system" already exists
error: 'istio-injection' already has a value (enabled), and --overwrite is false
"istio" already exists with the same configuration, skipping
Error: INSTALLATION FAILED: cannot re-use a name that is still in use
Error: INSTALLATION FAILED: cannot re-use a name that is still in use
Error: INSTALLATION FAILED: cannot re-use a name that is still in use
Error: INSTALLATION FAILED: cannot re-use a name that is still in use
./eks_main_setup_script.sh: line 175: jq: command not found
EPOD_URL is empty, exiting.....
===========================================================
[MONGO] Moving all primary replica to us-west-2
===========================================================
[WARNING]: Invalid characters were found in group names but not replaced, use
-vvvv to see details
MongoDB shell version v5.0.7
connecting to: mongodb://54.151.154.106:27017/test?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("1a21ae2b-5ebe-499d-a5d5-b99746fc6ea5") }
MongoDB server version: 5.0.7
================
Warning: the "mongo" shell has been superseded by "mongosh",
which delivers improved usability and compatibility.The "mongo" shell has been deprecated and will be removed in
an upcoming release.
For installation instructions, see
https://docs.mongodb.com/mongodb-shell/install/
================
bye
Finished
